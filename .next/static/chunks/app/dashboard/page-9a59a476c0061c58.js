(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[702],{2273:function(e,a,o){Promise.resolve().then(o.bind(o,8899))},9376:function(e,a,o){"use strict";var t=o(5475);o.o(t,"useRouter")&&o.d(a,{useRouter:function(){return t.useRouter}})},8899:function(e,a,o){"use strict";o.r(a),o.d(a,{default:function(){return i}});var t=o(7437),r=o(2265),s=o(9376);function i(){let[e,a]=(0,r.useState)("novo"),[o,i]=(0,r.useState)([]),[n,c]=(0,r.useState)([]),[l,d]=(0,r.useState)([]),[h,m]=(0,r.useState)(""),[u,p]=(0,r.useState)(""),v=(0,s.useRouter)(),[x,j]=(0,r.useState)({servicoId:"",proprietarioId:"",observacao:""}),[b,g]=(0,r.useState)(new Date),[N,f]=(0,r.useState)(""),[S,y]=(0,r.useState)(!1),[k,C]=(0,r.useState)(null),[D,I]=(0,r.useState)(!1),[w,A]=(0,r.useState)({nome:"",preco:""}),[E,T]=(0,r.useState)(null);(0,r.useEffect)(()=>{O()},[]);let O=async()=>{let e=localStorage.getItem("token");if(!e){v.push("/login");return}try{let a=JSON.parse(atob(e.split(".")[1]))["http://schemas.microsoft.com/ws/2008/06/identity/claims/role"]||"";m(a);let[o,t,r]=await Promise.all([fetch("https://localhost:7037/api/Servicos/todos",{headers:{Authorization:"Bearer ".concat(e)}}),fetch("https://localhost:7037/api/Proprietarios/todos",{headers:{Authorization:"Bearer ".concat(e)}}),fetch("https://localhost:7037/api/Agendamento/todos",{headers:{Authorization:"Bearer ".concat(e)}})]);o.ok&&i(await o.json()),t.ok&&c(await t.json()),r.ok&&d(await r.json())}catch(e){console.error("Erro ao carregar dados:",e)}},B=e=>{p(e),setTimeout(()=>p(""),3e3)},P=e=>{if(!x.proprietarioId)return!1;let[a,o]=e.split(":").map(Number),t=b.toISOString().split("T")[0];return l.some(e=>{var r;if((null===(r=e.proprietario)||void 0===r?void 0:r.id)!==parseInt(x.proprietarioId))return!1;let s=new Date(e.dataHora),i=s.toISOString().split("T")[0],n=s.getUTCHours(),c=s.getUTCMinutes();return t===i&&n===a&&c===o})},F=async e=>{e.preventDefault();let t=localStorage.getItem("token");if(!t){B("⚠️ Voc\xea precisa estar logado para agendar.");return}let r=o.find(e=>e.id===parseInt(x.servicoId));if(!r)return B("⚠️ Selecione um servi\xe7o v\xe1lido.");if(!N)return B("⚠️ Selecione um hor\xe1rio v\xe1lido.");let s="".concat(b.toISOString().split("T")[0],"T").concat(N,":00Z"),i={proprietarioId:parseInt(x.proprietarioId),servicoId:parseInt(x.servicoId),dataHora:s,observacao:x.observacao||"",precoFinal:parseFloat(r.preco||0),confirmado:!1};try{let e=await fetch("https://localhost:7037/api/Agendamento/criar",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},body:JSON.stringify(i)});if(!e.ok){let a=await e.text();B("❌ Erro: ".concat(a||e.statusText));return}B("✅ Agendamento criado com sucesso!"),j({servicoId:"",proprietarioId:"",observacao:""}),f(""),O(),a("meus")}catch(e){console.error("Erro ao criar agendamento:",e),B("❌ Erro ao realizar agendamento.")}},R=async e=>{e.preventDefault();let a=localStorage.getItem("token");if(!w.nome.trim()||!w.preco)return B("⚠️ Preencha nome e pre\xe7o.");try{(await fetch("https://localhost:7037/api/Servicos/criar",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(a)},body:JSON.stringify({nome:w.nome,preco:parseFloat(w.preco)})})).ok?(B("✅ Servi\xe7o criado com sucesso!"),A({nome:"",preco:""}),I(!1),O()):B("❌ Erro ao criar servi\xe7o.")}catch(e){console.error(e),B("❌ Falha ao conectar com o servidor.")}},z=async e=>{let a=localStorage.getItem("token");if(confirm("Deseja realmente excluir este servi\xe7o?"))try{(await fetch("https://localhost:7037/api/Servicos/".concat(e),{method:"DELETE",headers:{Authorization:"Bearer ".concat(a)}})).ok?(B("\uD83D\uDDD1️ Servi\xe7o exclu\xeddo!"),O()):B("❌ Erro ao excluir servi\xe7o.")}catch(e){console.error(e)}},H=async e=>{e.preventDefault();let a=localStorage.getItem("token");try{(await fetch("https://localhost:7037/api/Servicos/".concat(E.id),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(a)},body:JSON.stringify(E)})).ok?(B("\uD83D\uDCBE Servi\xe7o atualizado!"),T(null),O()):B("❌ Erro ao salvar altera\xe7\xf5es.")}catch(e){console.error(e)}};return(0,t.jsxs)("div",{className:"dashboard-container",children:[(0,t.jsxs)("div",{className:"dashboard-header",children:[(0,t.jsx)("h1",{className:"dashboard-title",children:"Agendamentos"}),(0,t.jsx)("p",{className:"dashboard-subtitle",children:"Agende seu hor\xe1rio com os melhores profissionais"})]}),(0,t.jsxs)("div",{className:"dashboard-tabs",children:[(0,t.jsx)("button",{className:"tab-button ".concat("novo"===e?"active":""),onClick:()=>a("novo"),children:"Novo Agendamento"}),(0,t.jsx)("button",{className:"tab-button ".concat("meus"===e?"active":""),onClick:()=>a("meus"),children:"Meus Agendamentos"})]}),"novo"===e?(0,t.jsx)("div",{className:"dashboard-content",children:(0,t.jsxs)("div",{className:"booking-grid",children:[(0,t.jsxs)("div",{className:"booking-section service-section",style:{position:"relative"},children:[(0,t.jsx)("h2",{className:"section-title",children:"Escolha o Servi\xe7o"}),"proprietario"===h.toLowerCase()&&(0,t.jsx)("button",{className:"add-service-btn-inside",onClick:()=>I(!0),title:"Adicionar novo servi\xe7o",children:"+"}),(0,t.jsx)("div",{className:"services-grid",children:o.map(e=>(0,t.jsxs)("div",{className:"service-card ".concat(parseInt(x.servicoId)===e.id?"selected":""),onClick:()=>j({...x,servicoId:e.id}),style:{position:"relative"},children:["proprietario"===h.toLowerCase()&&(0,t.jsx)("button",{className:"delete-icon-btn",onClick:a=>{a.stopPropagation(),z(e.id)},title:"Excluir servi\xe7o",children:"\uD83D\uDDD1️"}),(0,t.jsx)("h3",{children:e.nome}),(0,t.jsxs)("p",{className:"service-price",children:["R$ ",(e.preco||0).toFixed(2)]})]},e.id))}),D&&(0,t.jsx)("div",{className:"modal-overlay",children:(0,t.jsxs)("div",{className:"modal-box",children:[(0,t.jsx)("h3",{children:"Adicionar Novo Servi\xe7o"}),(0,t.jsxs)("form",{onSubmit:R,children:[(0,t.jsx)("input",{type:"text",placeholder:"Nome do servi\xe7o",value:w.nome,onChange:e=>A({...w,nome:e.target.value}),required:!0}),(0,t.jsx)("input",{type:"number",step:"0.01",placeholder:"Pre\xe7o (R$)",value:w.preco,onChange:e=>A({...w,preco:e.target.value}),required:!0}),(0,t.jsxs)("div",{className:"modal-actions",children:[(0,t.jsx)("button",{type:"button",className:"cancelar-btn",onClick:()=>I(!1),children:"Cancelar"}),(0,t.jsx)("button",{type:"submit",className:"confirmar-btn",children:"Adicionar"})]})]})]})})]}),D&&(0,t.jsx)("div",{className:"modal-overlay",children:(0,t.jsxs)("div",{className:"modal-box",children:[(0,t.jsx)("h3",{children:"Adicionar Novo Servi\xe7o"}),(0,t.jsxs)("form",{onSubmit:R,children:[(0,t.jsx)("input",{type:"text",placeholder:"Nome do servi\xe7o",value:w.nome,onChange:e=>A({...w,nome:e.target.value}),required:!0}),(0,t.jsx)("input",{type:"number",step:"0.01",placeholder:"Pre\xe7o (R$)",value:w.preco,onChange:e=>A({...w,preco:e.target.value}),required:!0}),(0,t.jsxs)("div",{className:"modal-actions",children:[(0,t.jsx)("button",{type:"button",className:"cancelar-btn",onClick:()=>I(!1),children:"Cancelar"}),(0,t.jsx)("button",{type:"submit",className:"confirmar-btn",children:"Adicionar"})]})]})]})}),E&&(0,t.jsx)("div",{className:"modal-overlay",children:(0,t.jsxs)("div",{className:"modal-box",children:[(0,t.jsx)("h3",{children:"Editar Servi\xe7o"}),(0,t.jsxs)("form",{onSubmit:H,children:[(0,t.jsx)("input",{type:"text",value:E.nome,onChange:e=>T({...E,nome:e.target.value})}),(0,t.jsx)("input",{type:"number",step:"0.01",value:E.preco,onChange:e=>T({...E,preco:e.target.value})}),(0,t.jsxs)("div",{className:"modal-actions",children:[(0,t.jsx)("button",{type:"button",className:"cancelar-btn",onClick:()=>T(null),children:"Cancelar"}),(0,t.jsx)("button",{type:"submit",className:"confirmar-btn",children:"Salvar"})]})]})]})}),(0,t.jsxs)("div",{className:"booking-section",children:[(0,t.jsx)("h2",{className:"section-title",children:"Escolha o Barbeiro"}),(0,t.jsx)("div",{className:"barbers-grid",children:n.map(e=>{var a;return(0,t.jsxs)("div",{className:"barber-card ".concat(parseInt(x.proprietarioId)===e.id?"selected":""),onClick:()=>j({...x,proprietarioId:e.id}),children:[(0,t.jsx)("div",{className:"barber-avatar",children:(null===(a=e.nome)||void 0===a?void 0:a.charAt(0))||"?"}),(0,t.jsx)("h3",{children:e.nome})]},e.id)})})]}),(0,t.jsxs)("div",{className:"booking-section",children:[(0,t.jsx)("h2",{className:"section-title",children:"Escolha a Data"}),(()=>{let e=new Date,a=new Date(b.getFullYear(),b.getMonth(),1),o=new Date(b.getFullYear(),b.getMonth()+1,0),r=[],s=a.getDay();for(let e=0;e<s;e++)r.push((0,t.jsx)("div",{className:"calendar-day empty"},"empty-".concat(e)));for(let a=1;a<=o.getDate();a++){let o=new Date(b.getFullYear(),b.getMonth(),a),s=o.toDateString()===b.toDateString(),i=o<e.setHours(0,0,0,0);r.push((0,t.jsx)("div",{className:"calendar-day ".concat(s?"selected":""," ").concat(i?"past":""),onClick:()=>!i&&g(o),children:a},a))}return(0,t.jsxs)("div",{className:"calendar-container fixed-calendar",children:[(0,t.jsxs)("div",{className:"calendar-header",children:[(0,t.jsx)("button",{onClick:()=>g(new Date(b.getFullYear(),b.getMonth()-1)),className:"calendar-nav",children:"←"}),(0,t.jsx)("h3",{children:b.toLocaleDateString("pt-BR",{month:"long",year:"numeric"})}),(0,t.jsx)("button",{onClick:()=>g(new Date(b.getFullYear(),b.getMonth()+1)),className:"calendar-nav",children:"→"})]}),(0,t.jsx)("div",{className:"calendar-weekdays",children:["Dom","Seg","Ter","Qua","Qui","Sex","S\xe1b"].map(e=>(0,t.jsx)("div",{className:"weekday",children:e},e))}),(0,t.jsx)("div",{className:"calendar-grid",children:r})]})})()]}),(0,t.jsxs)("div",{className:"booking-section",children:[(0,t.jsx)("h2",{className:"section-title",children:"Escolha o Hor\xe1rio"}),(0,t.jsx)("div",{className:"time-grid",children:["09:00","09:30","10:00","10:30","11:00","11:30","14:00","14:30","15:00","15:30","16:00","16:30","17:00","17:30","18:00","18:30"].map(e=>{let a=P(e);return(0,t.jsx)("button",{className:"time-slot ".concat(N===e?"selected":""," ").concat(a?"disabled":""),onClick:()=>!a&&f(e),disabled:a,title:a?"Hor\xe1rio j\xe1 agendado":"Dispon\xedvel",children:e},e)})})]}),(0,t.jsxs)("div",{className:"booking-section full-width",children:[(0,t.jsx)("h2",{className:"section-title",children:"Observa\xe7\xf5es (Opcional)"}),(0,t.jsx)("textarea",{className:"barber-textarea",placeholder:"Alguma prefer\xeancia ou observa\xe7\xe3o?",value:x.observacao,onChange:e=>j({...x,observacao:e.target.value}),rows:"4"})]}),(0,t.jsx)("div",{className:"booking-section full-width",children:(0,t.jsx)("button",{className:"barber-button",onClick:F,disabled:!x.servicoId||!x.proprietarioId||!N,children:"Confirmar Agendamento"})})]})}):(0,t.jsx)("div",{className:"dashboard-content",children:(0,t.jsx)("div",{className:"appointments-list",children:0===l.length?(0,t.jsx)("div",{className:"empty-state",children:(0,t.jsx)("p",{children:"Voc\xea ainda n\xe3o tem agendamentos."})}):l.map(e=>{var a,o;return(0,t.jsxs)("div",{className:"appointment-card",children:[(0,t.jsxs)("div",{className:"appointment-header",children:[(0,t.jsx)("h3",{children:(null===(a=e.servico)||void 0===a?void 0:a.nome)||"Servi\xe7o"}),(0,t.jsx)("span",{className:"status-badge ".concat(e.confirmado?"confirmed":"pending"),children:e.confirmado?"Confirmado":"Pendente"})]}),(0,t.jsxs)("div",{className:"appointment-details",children:[(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"Barbeiro:"})," ",(null===(o=e.proprietario)||void 0===o?void 0:o.nome)||"N/A"]}),(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"Data/Hora:"})," ",new Date(e.dataHora).toLocaleString("pt-BR")]}),(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"Pre\xe7o:"})," R$ ",(e.precoFinal||0).toFixed(2)]}),e.observacao&&(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"Obs:"})," ",e.observacao]})]})]},e.id)})})}),"Proprietario"===h&&(0,t.jsx)("button",{className:"admin-button",onClick:()=>v.push("/admin/agendamentos"),children:"\uD83D\uDCCB Ver Todos (Admin)"}),u&&(0,t.jsx)("div",{className:"toast",children:u})]})}o(3676),o(4573)},3676:function(){},4573:function(){}},function(e){e.O(0,[826,565,971,117,744],function(){return e(e.s=2273)}),_N_E=e.O()}]);